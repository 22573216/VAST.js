<html>
<head>

<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">

<script type="text/javascript" src="../lib/voronoi/point2d.js"></script>
<script type="text/javascript" src="../lib/voronoi/segment.js"></script>
<script type="text/javascript" src="../lib/voronoi/line2d.js"></script>
<script type="text/javascript" src="../lib/rhill-voronoi-core-min.js"></script>
<script type="text/javascript" src="../lib/common/logger.js"></script>
<script type="text/javascript" src="../lib/voronoi/vast_voro.js"></script>

<script type="text/javascript">


var IntersectDemo = {

    line: new segment(new point2d(100, 100), new point2d(300, 500)),
    circle: { center: new point2d(500,500), radius: 50 },
	margin: 50,
	canvas: null,

    init: function() {
		this.canvas = document.getElementById('voronoiCanvas');
		this.render();
    },

    render: function() {
		var ctx = this.canvas.getContext('2d');

		// background
		ctx.globalAlpha = 1;
		ctx.beginPath();
		ctx.rect(0,0,this.canvas.width,this.canvas.height);
		ctx.fillStyle = 'white';
		ctx.fill();
		ctx.strokeStyle = '#888';
        ctx.lineWidth = 1;
		ctx.stroke();

		// edges
		ctx.beginPath();
		ctx.strokeStyle='#000';
		ctx.moveTo(this.line.p1.x,this.line.p1.y);
		ctx.lineTo(this.line.p2.x,this.line.p2.y);
		ctx.stroke();
		},
	};


    // mouse position detection & drawing

    Element.prototype.leftTopScreen = function () {
        var x = 0;
        var y = 0;

        //alert('this offset: x ' + x + ' y: ' + y);

        var element = this.offsetParent;
        //alert('parent offset: x ' + element.offsetLeft + ' y: ' + element.offsetTop);

        var canvas = document.getElementById ("voronoiCanvas");
        //alert('canvas offset: x ' + canvas.offsetLeft + ' y: ' + canvas.offsetTop);


        while (element !== null) {
            x = parseInt (x) + parseInt (element.offsetLeft);
            y = parseInt (y) + parseInt (element.offsetTop);

            element = element.offsetParent;
        }


        return new Array (x, y);
    }


    //var canvas = document.getElementById ("voronoiCanvas");
    var curr_id = 0;

    document.addEventListener ("DOMContentLoaded", function () {
        var canvas = document.getElementById ("voronoiCanvas");

        var mouse_x = document.getElementById ("mouse_x");
        var mouse_y = document.getElementById ("mouse_y");

        var xy = canvas.leftTopScreen ();

        var context = canvas.getContext ("2d");

        context.fillStyle = "rgb(255,255,255)";
        context.fillRect (0, 0, 500, 500);


        // re-obtain origin point
        canvas.addEventListener ("mouseover", function (event) {
            xy = canvas.leftTopScreen ();
        });

        canvas.addEventListener ("mousemove", function (event) {

            var x, y;

            if(event.offsetX) {
                x = event.offsetX;
                y = event.offsetY;
            }
            else if(event.layerX) {
                x = event.layerX;
                y = event.layerY;
            }

            // get adjusted x & y coordinates
            x = x - xy[0];
            y = y - xy[1];

            IntersectDemo.circle.center.set(x,y);

            IntersectDemo.render();

            // draw dot at current position
            context.fillStyle = "rgb(255, 0, 0)";
            context.fillRect (x, y, 3, 3);
            context.fill();

            context.beginPath();
            context.strokeStyle='#000';
            context.lineWidth = 2;
            context.arc(x, y, IntersectDemo.circle.radius, 0, Math.PI*2, true);
            context.stroke();

            if (IntersectDemo.line.intersects(IntersectDemo.circle.center, IntersectDemo.circle.radius)) {
                context.beginPath();
                context.fillStyle='#00F';
                context.arc(x, y, IntersectDemo.circle.radius, 0, Math.PI*2, true);
                context.fill();
            }

            var point = IntersectDemo.line.intersectionPoint(IntersectDemo.circle.center);

            // vectors
            context.beginPath();
            context.strokeStyle='#0F0';
            context.moveTo(IntersectDemo.line.p1.x, IntersectDemo.line.p1.y);
            context.lineTo(IntersectDemo.circle.center.x, IntersectDemo.circle.center.y);
            context.stroke();

            context.beginPath();
            context.strokeStyle='#F00';
            context.moveTo(IntersectDemo.line.p1.x, IntersectDemo.line.p1.y);
            context.lineTo(point.x, point.y);
            context.stroke();

            context.beginPath();
            context.strokeStyle='#55F';
            context.moveTo(point.x, point.y);
            context.lineTo(IntersectDemo.circle.center.x,IntersectDemo.circle.center.y);
            context.stroke();
        });
    });






// -->
</script>


</head>

<body onload="IntersectDemo.init()">
<h1>Segment intersection test</h1>
<div id="divroot" style="width:800px;">
<div id="canvasParent">
<noscript>You need to enable Javascript in your browser for this page to display properly.</noscript>
<canvas id="voronoiCanvas" width="1000" height="1000" onclick=""></canvas>

</body>
